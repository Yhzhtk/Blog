---
layout: post
title: centos安装和配置gitlab
description: 官方首页给的安装gitlab方法是使用一个个的命令，逐步安装，这在Ubuntu/Debian 系统上比较容易。但在centos上就会出现各种问题，我的方式是下载gitlab的一个rpm包，所有依赖都已经包含在里面了，一键安装，然后进行一些列的配置就行了。
tags: [rpm安装gitlab]
---

<div class="entry-content"><p><a href="https://github.com/gitlabhq/gitlabhq" target="_blank">GitLab</a> 是一个开源的模仿 github 的项目，提供 git-shell 和 git-web 的功能，既能用命令操作，也有Web端的操作界面。</p>
<p>官方首页给的<a href="https://github.com/gitlabhq/gitlab-recipes/tree/master/install/centos" target="_blank">安装gitlab</a>方法是使用一个个的命令，逐步安装，这在<span style="color: #333333;">Ubuntu/Debian 系统上比较容易。但在centos上就会出现各种问题，我的方式是下载gitlab的一个rpm包，所有依赖都已经包含在里面了，一键安装，然后进行一些列的配置就行了。</span></p>
<h2>1、下载RPM包</h2>
<p>资源链接：<a href="https://www.gitlab.com/downloads/" target="_blank">https://www.gitlab.com/downloads/</a></p>
<p>直接下载地址：<a href="http://downloads-packages.s3.amazonaws.com/gitlab-6.7.2_omnibus-1.el6.x86_64.rpm">gitlab-6.7.2_omnibus-1.el6.x86_64.rpm</a></p>
<h2>2、安装</h2>
<p>rpm包，使用-ivh参数即可安装，运行以下命令，默认安装的路径在&nbsp;/opt/gitlab/ 下<span id="more-108"></span></p>
<pre class="EnlighterJSRAW" data-enlighter-language="ruby" style="display: none;">&nbsp;rpm -ivh gitlab-6.7.2_omnibus-1.el6.x86_64.rpm</pre><ol class="enlighterEnlighterJS EnlighterJS" id="EnlighterJS_hvhvp35d"><li class="firstline lastline odd hoverEnabled"><span class="unknown"> rpm -ivh gitlab-</span><span class="nu0">6.7</span><span class="unknown">.</span><span class="me0">2_omnibus</span><span class="unknown">-</span><span class="nu0">1</span><span class="unknown">.</span><span class="me0">el6</span><span class="unknown">.</span><span class="me0">x86_64</span><span class="unknown">.</span><span class="me0">rpm</span></li></ol>
<h2>3、初始化</h2>
<p>安装完了需要初始化<span style="color: #333333;">PostgreSQL</span>、Nginx、<span style="color: #333333;">Redis</span>等，运行以下命令</p>
<pre class="EnlighterJSRAW" data-enlighter-language="ruby" style="display: none;">gitlab-ctl reconfigure</pre><ol class="enlighterEnlighterJS EnlighterJS" id="EnlighterJS_hvhvp35e"><li class="firstline lastline odd hoverEnabled"><span class="unknown">gitlab-ctl reconfigure</span></li></ol>
<p>这其中用到了 gitlab-ctl，这用于控制gitlab，详细参数说明如下：</p>
<pre style="font-size: 10px;">cleanse
 Delete *all* gitlab data, and start from scratch.
 graceful-kill
 Attempt a graceful stop, then SIGKILL the entire process group.
 help
 Print this help message.
 hup
 Send the services a HUP.
 int
 Send the services an INT.
 kill
 Send the services a KILL.
 once
 Start the services if they are down. Do not restart them if they stop.
 reconfigure
 Reconfigure the application.
 restart
 Stop the services if they are running, then start them again.
 service-list
 List all the services (enabled services appear with a *.)
 show-config
 Show the configuration that would be generated by reconfigure.
 start
 Start services if they are down, and restart them if they stop.
 status
 Show the status of all the services.
 stop
 Stop the services, and do not restart them.
 tail
 Watch the service logs of all enabled services.
 term
 Send the services a TERM.
 uninstall
 Kill all processes and uninstall the process supervisor (data will be preserved).</pre>
<p>其中最常用的就是 start(开始) 和 stop (结束)了。这时就可以通过start启动gitlab</p>
<pre class="EnlighterJSRAW" data-enlighter-language="ruby" style="display: none;">gitlab-ctl start</pre><ol class="enlighterEnlighterJS EnlighterJS" id="EnlighterJS_hvhvp35f"><li class="firstline lastline odd hoverEnabled"><span class="unknown">gitlab-ctl start</span></li></ol>
<h2>4、配置系统邮件</h2>
<p>gitlab 在注册需要发送邮件，项目更改也需要发送邮箱，所以需要配置一个邮箱。</p>
<p>编辑&nbsp;<b style="color: #2c2c2c;">/opt/gitlab/embedded/service/gitlab-rails/config/environments/production.rb</b></p>
<div><span style="color: #2c2c2c;">在 &nbsp;<em># config.action_mailer.delivery_method = :sendmail</em>&nbsp;下加入，# 表示注释。</span></div>
<pre class="EnlighterJSRAW" data-enlighter-language="ruby" style="display: none;"><span style="color: #2c2c2c;"># config.action_mailer.delivery_method = :sendmail</span>
config.action_mailer.delivery_method = :smtp
config.action_mailer.perform_deliveries = true
config.action_mailer.raise_delivery_errors = true
 
config.action_mailer.smtp_settings = {
  :address              =&gt; "smtp.gmail.com",
  :port                 =&gt; 587,
  :domain               =&gt; 'gmail.com',
  :user_name            =&gt; 'account@gmail.com',
  :password             =&gt; 'password',
  :authentication       =&gt;  :plain,
  :enable_starttls_auto =&gt; true
}
</pre><ol class="enlighterEnlighterJS EnlighterJS" id="EnlighterJS_hvhvp35g"><li class="firstline odd hoverEnabled"><span class="unknown">&lt;span style=</span><span class="st0">"color: #2c2c2c;"</span><span class="unknown">&gt;# config.</span><span class="me0">action_mailer</span><span class="unknown">.</span><span class="me0">delivery_method</span><span class="unknown"> = </span><span class="kw4">:sendmail</span><span class="unknown">&lt;/span&gt;</span></li><li class="even hoverEnabled"><span class="unknown">config.</span><span class="me0">action_mailer</span><span class="unknown">.</span><span class="me0">delivery_method</span><span class="unknown"> = </span><span class="kw4">:smtp</span><span class="unknown"></span></li><li class="odd hoverEnabled"><span class="unknown">config.</span><span class="me0">action_mailer</span><span class="unknown">.</span><span class="me0">perform_deliveries</span><span class="unknown"> = </span><span class="kw1">true</span><span class="unknown"></span></li><li class="even hoverEnabled"><span class="unknown">config.</span><span class="me0">action_mailer</span><span class="unknown">.</span><span class="me0">raise_delivery_errors</span><span class="unknown"> = </span><span class="kw1">true</span><span class="unknown"></span></li><li class="odd hoverEnabled"><span class="unknown"> </span></li><li class="even hoverEnabled"><span class="unknown">config.</span><span class="me0">action_mailer</span><span class="unknown">.</span><span class="me0">smtp_settings</span><span class="unknown"> = </span><span class="br0">{</span><span class="unknown"></span></li><li class="odd hoverEnabled"><span class="unknown">  </span><span class="kw4">:address</span><span class="unknown">              =&gt; </span><span class="st0">"smtp.gmail.com"</span><span class="unknown">,</span></li><li class="even hoverEnabled"><span class="unknown">  </span><span class="kw4">:port</span><span class="unknown">                 =&gt; </span><span class="nu0">587</span><span class="unknown">,</span></li><li class="odd hoverEnabled"><span class="unknown">  </span><span class="kw4">:domain</span><span class="unknown">               =&gt; </span><span class="st0">'gmail.com'</span><span class="unknown">,</span></li><li class="even hoverEnabled"><span class="unknown">  </span><span class="kw4">:user_name</span><span class="unknown">            =&gt; </span><span class="st0">'account@gmail.com'</span><span class="unknown">,</span></li><li class="odd hoverEnabled"><span class="unknown">  </span><span class="kw4">:password</span><span class="unknown">             =&gt; </span><span class="st0">'password'</span><span class="unknown">,</span></li><li class="even hoverEnabled"><span class="unknown">  </span><span class="kw4">:authentication</span><span class="unknown">       =&gt;  </span><span class="kw4">:plain</span><span class="unknown">,</span></li><li class="odd hoverEnabled"><span class="unknown">  </span><span class="kw4">:enable_starttls_auto</span><span class="unknown"> =&gt; </span><span class="kw1">true</span><span class="unknown"></span></li><li class="lastline even hoverEnabled"><span class="unknown"></span><span class="br0">}</span></li></ol>
<p>修改显示的邮箱，打开以下文件，找到指定位置，修改即可</p>
<p><b>/opt/gitlab/embedded/service/gitlab-rails/config/gitlab.yml&nbsp;</b></p>
<pre class="EnlighterJSRAW" style="color: rgb(44, 44, 44); display: none;" data-enlighter-language="ruby"> # Email address used in the "From" field in mails sent by GitLab
 email_from: account@gmail.com
 # Email address of your support contact (default: same as email_from)
 support_email:account@gmail.com</pre><ol class="enlighterEnlighterJS EnlighterJS" id="EnlighterJS_hvhvp35h"><li class="firstline odd hoverEnabled"><span class="unknown"> </span><span class="co1"># Email address used in the "From" field in mails sent by GitLab</span><span class="unknown"></span></li><li class="even hoverEnabled"><span class="unknown"> email_from: account</span><span class="kw3">@gmail</span><span class="unknown">.</span><span class="me0">com</span><span class="unknown"></span></li><li class="odd hoverEnabled"><span class="unknown"> </span><span class="co1"># Email address of your support contact (default: same as email_from)</span><span class="unknown"></span></li><li class="lastline even hoverEnabled"><span class="unknown"> support_email</span><span class="kw4">:account</span><span class="kw3">@gmail</span><span class="unknown">.</span><span class="me0">com</span></li></ol>
<h2>5、设置访问的IP或者域名</h2>
<p>GitLab设置IP或者域名有两个地方，一个是web端(gitlab-rails)的，一是git-shell的，配置修改如下。</p>
<p>1、打开<strong>&nbsp;/opt/gitlab/embedded/service/gitlab-rails/config/gitlab.yml</strong></p>
<p>找到以下内容可修改，包括端口号，域名信息，还可以开启和停用https</p>
<pre class="EnlighterJSRAW" data-enlighter-language="ruby" style="display: none;">  ## GitLab settings
  gitlab:
    ## Web server settings (note: host is the FQDN, do not include http://)
    host: gitlab.com
    port: 80
    https: false</pre><ol class="enlighterEnlighterJS EnlighterJS" id="EnlighterJS_hvhvp35i"><li class="firstline odd hoverEnabled"><span class="unknown">  </span><span class="co1">## GitLab settings</span><span class="unknown"></span></li><li class="even hoverEnabled"><span class="unknown">  gitlab:</span></li><li class="odd hoverEnabled"><span class="unknown">    </span><span class="co1">## Web server settings (note: host is the FQDN, do not include http://)</span><span class="unknown"></span></li><li class="even hoverEnabled"><span class="unknown">    host: gitlab.</span><span class="me0">com</span><span class="unknown"></span></li><li class="odd hoverEnabled"><span class="unknown">    port: </span><span class="nu0">80</span><span class="unknown"></span></li><li class="lastline even hoverEnabled"><span class="unknown">    https: </span><span class="kw1">false</span></li></ol>
<p>2、打开&nbsp;<strong>/opt/gitlab/embedded/service/gitlab-shell/config.yml&nbsp;</strong></p>
<p>直接修改gitlab_url，表示shell访问时的域名</p>
<pre class="EnlighterJSRAW" data-enlighter-language="ruby" style="display: none;">gitlab_url: "http://gitlab.com"</pre><ol class="enlighterEnlighterJS EnlighterJS" id="EnlighterJS_hvhvp35j"><li class="firstline lastline odd hoverEnabled"><span class="unknown">gitlab_url: </span><span class="st0">"http://gitlab.com"</span></li></ol>
<p>最后运行成功后，效果如下：</p>
<p><a href="http://justdull.com/wp-content/uploads/2014/05/gitlab.gif"><img class="aligncenter wp-image-119" src="http://justdull.com/wp-content/uploads/2014/05/gitlab.gif" alt="gitlab" width="600" height="446"></a></p>
</div>
